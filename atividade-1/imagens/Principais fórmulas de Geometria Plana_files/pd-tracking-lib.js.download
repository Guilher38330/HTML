var pdTrackingLib=function(){var i,c,h={utils:{},services:{}};function n(e,n){if(!n[e]||"function"!=typeof n[e])throw new Error("Invalid "+e+" function")}function r(e,n,i){n.PdUtm=window.location.search.slice(1).split("&").filter(function(e){return e.startsWith("pd_")}).join("&");var{anonUserId:t=null,anonSessionId:s=null,flagrExperiments:o=null,countryId:a=null,languageId:r=null}=c,i={SessionId:i,EventName:e,Data:n={anonUserId:t,anonSessionId:s,flagrExperiments:o,countryId:a,languageId:r,...n},TrackingLibVersion:"16.0.25"};console.log("[PD Tracking Lib]",e,JSON.stringify(i));h.utils.ajaxRequest.ajaxRequest("POST","https://tracking-api.passeidireto.com/track",i,c.clientData,function(e){},function(e){console.error("[PD Tracking Lib] Something went wrong with event tracking",e)})}return h.utils.ajaxRequest={ajaxRequest:function(e,n,i,t,s,o){var n=-1<window.location.host.indexOf(".studenta.com")?n.replace(".passeidireto.com",".studenta.com"):n,a=new XMLHttpRequest;a.onreadystatechange=function(){var e;a.readyState==XMLHttpRequest.DONE&&(200<=a.status&&a.status<=299?s(a.responseText&&""!=a.responseText?JSON.parse(a.responseText):null):(o({status:a.status,data:a.responseText}),e=new CustomEvent("httpErrorEvent",{detail:{error:{response:a}}}),window.dispatchEvent(e)))},a.open(e,n,!0),a.withCredentials=!0,a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Accept","application/json"),a.setRequestHeader("pd-app-client-id",t.id||t.name),a.setRequestHeader("pd-app-client-version",t.version),"POST"==e?a.send(JSON.stringify(i)):a.send()}},h.utils.cookies=(i=-1<window.location.host.indexOf(".studenta.com")?".studenta.com":".passeidireto.com",{setCookie:function(e,n){e=[e,"=",JSON.stringify(n),"; domain=",i,"; path=/;"].join(""),document.cookie=e},getCookie:function(n){n=document.cookie.match(new RegExp(n+"=([^;]+)"));try{n=n&&JSON.parse(n[1])}catch(e){n=n&&n[1]}return n},removeCookie:function(e,n){n=n||i,document.cookie=[e,"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/; domain=",n].join("")},overrideCookiesUtils:function(e){n("setCookie",e),n("getCookie",e),n("removeCookie",e),Object.assign({},h.utils.cookies,e)}}),h.utils.debounce={debounce:function(t,s,o){var a;return function(){var e=this,n=arguments,i=o&&!a;clearTimeout(a),a=setTimeout(function(){a=null,o||t.apply(e,n)},s),i&&t.apply(e,n)}}},h.services.eventTracking={track:function(e,n){return function e(n,i,t){var s=h.services.sessionTracking.getSessionId(),o=parseInt("500"),a=parseInt("10000")/o;0<s||c&&c.anonymous?r(n,i,s):t<a?(console.warn("[PD Tracking Lib] Session Tracking is not ready, delaying to send. Attempt:",++t),setTimeout(function(){e(n,i,t)},o)):console.error("[PD Tracking Lib] Session Tracking is not ready, giving up")}(e,n,0)},init:function(e){c=e}},h.services.materialReadTracking=function(){const n=parseInt("10000");var i,t;function e(e){t=e,h.services.sessionActivity.isSessionActive()?(s(),i=setInterval(function(){h.services.eventTracking.track("MaterialRead",{MaterialId:e,MaterialReadInterval:n})},n),h.services.sessionActivity.bindSessionInactiveCallback(a)):a()}function s(){i&&(clearInterval(i),i=null),h.services.sessionActivity.unbindSessionInactiveCallback(a),h.services.sessionActivity.unbindSessionActiveCallback(o)}function o(){e(t),h.services.sessionActivity.unbindSessionActiveCallback(o)}function a(){s(),h.services.sessionActivity.bindSessionActiveCallback(o)}return{startMaterialRead:e,stopMaterialRead:function(){s(),t=null}}}(),h.services.materialWatchedTracking=function(){const n=parseInt("10000");var i;function t(){i&&(clearInterval(i),i=null)}return{startMaterialWatched:function(e){t(),i=setInterval(function(){h.services.eventTracking.track("MaterialWatched",{MaterialId:e,MaterialWatchedInterval:n,OnTab:!document.hidden})},n)},stopMaterialWatched:function(){t(),0}}}(),h.services.sessionActivity=function(){var s,n,e=h.utils.debounce;const i=parseInt("600000");var t=[],o=[];function a(e){n?clearTimeout(n):e||(console.log("[PD Tracking Lib]","Session active"),setTimeout(function(){t.forEach(function(e){e()})})),n=setTimeout(function(){n=null,console.log("[PD Tracking Lib]","Session inative"),o.forEach(function(e){e()})},e?0:i)}return{initSession:function(e,n,i){n=void 0===n?function(){}:n,i=void 0===i?function(){}:i;var t=e;if(!t.anonymous&&(!t.userId||t.userId<1))throw new Error("Invalid userId");if(!t.currentLocation)throw new Error("Invalid currentLocation");if(!t.clientData)throw new Error("Invalid clientData");if((!t.clientData.id||t.clientData.id<1)&&!t.clientData.name)throw new Error("Invalid clientData.id and clientData.name");if(!t.clientData.version)throw new Error("Invalid clientData.version");s=e,h.services.sessionTracking.init(s),h.services.eventTracking.init(s),e.anonymous?n():h.services.sessionTracking.trackSession(n,i)},userActivityEventListener:e.debounce(function(){a(),h.services.sessionTracking.trackSession()},500),userInactivityEventListener:function(){a(!0)},bindSessionActiveCallback:function(e){t.push(e)},unbindSessionActiveCallback:function(e){e=t.indexOf(e),t.splice(e,1)},bindSessionInactiveCallback:function(e){o.push(e)},unbindSessionInactiveCallback:function(e){e=o.indexOf(e),o.splice(e,1)},isSessionActive:function(){return!!n}}}(),h.services.sessionTracking=function(){const k="last-session-tracking-call",g="last-session-tracking-id";var p,I;function m(e){return e+"_"+I.clientData.id}function S(e){return"number"==typeof e&&0<e}function T(){h.utils.cookies.removeCookie(m(k)),h.utils.cookies.removeCookie(m(g))}function o(n,i){var e=window.location.href,t=document.referrer,s=h.utils.cookies.getCookie("first_accessed_page"),o=h.utils.cookies.getCookie("first_accessed_page_referer"),{anonUserId:a=null,anonSessionId:r=null,flagrExperiments:c=null,countryId:u=null}=I,l=I.userId,d=I.languageId||null,v=I.host||null,l=(h.utils.cookies.setCookie(m(k),(new Date).toISOString()),"https://session-tracking-api.passeidireto.com/session/"+l+"/track");const f={currentUrl:e,referrerUrl:t,FirstAccessedPage:s,FirstAccessedPageReferrer:o,countryId:u,languageId:d,host:v,anonUserId:a,anonSessionId:r,flagrExperiments:c};console.log("[PD Tracking Lib]","SessionTracking",JSON.stringify(f)),h.utils.ajaxRequest.ajaxRequest("POST",l,f,I.clientData,function(e){(e&&S(e.SessionId)?(p=e.SessionId,h.utils.cookies.setCookie(m(g),p),n):(windowUtil.trackWarn("Invalid session id",{},{...f,...e}),p=-1,T(),i))()},function(e){var n=new Error("Fail to register session tracking");n.name="SessionTrackingAPIError",windowUtil.trackError(n,{request_error:!0,request_status:e.status},{...f}),console.error("[PD Tracking Lib] Something went wrong with session tracking",e),p=-1,T(),i(e)})}return{init:function(e){I=e},trackSession:function(e,n){e=void 0===e?function(){}:e,n=void 0===n?function(){}:n;var i=h.utils.cookies.getCookie(m(k)),t=h.utils.cookies.getCookie(m(g));if(!i||!t)return o(e,n);var i=new Date(i),s=new Date;Math.abs(i-s)>=parseInt("3600000")?o(e,n):S(p)||(p=t,e())},getSessionId:function(){return p},getSessionKey:function(){return I.sessionKey}}}(),{overrideCookiesUtils:h.utils.cookies.overrideCookiesUtils,initSession:h.services.sessionActivity.initSession,userActivityEventListener:h.services.sessionActivity.userActivityEventListener,userInactivityEventListener:h.services.sessionActivity.userInactivityEventListener,trackEvent:h.services.eventTracking.track,startMaterialRead:h.services.materialReadTracking.startMaterialRead,stopMaterialRead:h.services.materialReadTracking.stopMaterialRead,startMaterialWatched:h.services.materialWatchedTracking.startMaterialWatched,stopMaterialWatched:h.services.materialWatchedTracking.stopMaterialWatched,version:"16.0.25"}}();